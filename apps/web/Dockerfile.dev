FROM node:20-alpine

# Install git (required for some pnpm dependencies) and pnpm
RUN apk add --no-cache git && npm install -g pnpm

WORKDIR /workspace

# Copy workspace root files (when context is root dir)
COPY package.json pnpm-lock.yaml* pnpm-workspace.yaml ./

# Copy package.json files for all workspace packages
COPY apps/api/package.json ./apps/api/
COPY apps/web/package.json ./apps/web/

# Install all workspace dependencies
RUN pnpm install --frozen-lockfile

# Copy all web source code
COPY apps/web ./apps/web

# Set working directory to web app
WORKDIR /workspace/apps/web

# Expose port
EXPOSE 3000

# Start development server
CMD ["pnpm", "run", "dev"]
